"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[17216],{28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>i});var s=t(96540);const r={},o=s.createContext(r);function c(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(o.Provider,{value:n},e.children)}},71392:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"typescript-api/natural-language-processing/LLMModule","title":"LLMModule","description":"TypeScript API implementation of the useLLM hook.","source":"@site/docs/04-typescript-api/01-natural-language-processing/LLMModule.md","sourceDirName":"04-typescript-api/01-natural-language-processing","slug":"/typescript-api/natural-language-processing/LLMModule","permalink":"/react-native-executorch/docs/next/typescript-api/natural-language-processing/LLMModule","draft":false,"unlisted":false,"editUrl":"https://github.com/software-mansion/react-native-executorch/edit/main/docs/docs/04-typescript-api/01-natural-language-processing/LLMModule.md","tags":[],"version":"current","frontMatter":{"title":"LLMModule"},"sidebar":"tutorialSidebar","previous":{"title":"Natural Language Processing","permalink":"/react-native-executorch/docs/next/category/natural-language-processing-1"},"next":{"title":"SpeechToTextModule","permalink":"/react-native-executorch/docs/next/typescript-api/natural-language-processing/SpeechToTextModule"}}');var r=t(74848),o=t(28453);const c={title:"LLMModule"},i=void 0,a={},l=[{value:"API Reference",id:"api-reference",level:2},{value:"High Level Overview",id:"high-level-overview",level:2},{value:"Methods",id:"methods",level:3},{value:"Loading the model",id:"loading-the-model",level:2},{value:"Listening for download progress",id:"listening-for-download-progress",level:2},{value:"Running the model",id:"running-the-model",level:2},{value:"Listening for generated tokens",id:"listening-for-generated-tokens",level:2},{value:"Interrupting the model",id:"interrupting-the-model",level:2},{value:"Token Batching",id:"token-batching",level:2},{value:"Configuring the model",id:"configuring-the-model",level:2},{value:"Deleting the model from memory",id:"deleting-the-model-from-memory",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["TypeScript API implementation of the ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/hooks/natural-language-processing/useLLM",children:"useLLM"})," hook."]}),"\n",(0,r.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["For detailed API Reference for ",(0,r.jsx)(n.code,{children:"LLMModule"})," see: ",(0,r.jsxs)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule",children:[(0,r.jsx)(n.code,{children:"LLMModule"})," API Reference"]}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["For all LLM models available out-of-the-box in React Native ExecuTorch see: ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/#models---lmm",children:"LLM Models"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["For useful LLM utility functionalities please refer to the following link: ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/#utilities---llm",children:"LLM Utility Functionalities"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"high-level-overview",children:"High Level Overview"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { LLMModule, LLAMA3_2_1B_QLORA } from 'react-native-executorch';\n\n// Creating an instance\nconst llm = new LLMModule({\n  tokenCallback: (token) => console.log(token),\n  messageHistoryCallback: (messages) => console.log(messages),\n});\n\n// Loading the model\nawait llm.load(LLAMA3_2_1B_QLORA, (progress) => console.log(progress));\n\n// Running the model - returns the generated response\nconst response = await llm.sendMessage('Hello, World!');\nconsole.log('Response:', response);\n\n// Interrupting the model (to actually interrupt the generation it has to be called when sendMessage or generate is running)\nllm.interrupt();\n\n// Deleting the model from memory\nllm.delete();\n"})}),"\n",(0,r.jsx)(n.h3,{id:"methods",children:"Methods"}),"\n",(0,r.jsxs)(n.p,{children:["All methods of ",(0,r.jsx)(n.code,{children:"LLMModule"})," are explained in details here: ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule",children:"LLMModule API Reference"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"loading-the-model",children:"Loading the model"}),"\n",(0,r.jsxs)(n.p,{children:["To create a new instance of ",(0,r.jsx)(n.code,{children:"LLMModule"}),", use the ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#constructor",children:"constructor"})," with optional callbacks:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#tokencallback",children:(0,r.jsx)(n.code,{children:"tokenCallback"})})," - Function called on every generated token."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#messagehistorycallback",children:(0,r.jsx)(n.code,{children:"messageHistoryCallback"})})," - Function called on every finished message."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Then, to load the model, use the ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#load",children:(0,r.jsx)(n.code,{children:"load"})})," method. It accepts an object with the following fields:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#model",children:(0,r.jsx)(n.code,{children:"model"})})," - Object containing:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#modelsource",children:(0,r.jsx)(n.code,{children:"modelSource"})})," - The location of the used model."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#tokenizersource",children:(0,r.jsx)(n.code,{children:"tokenizerSource"})})," - The location of the used tokenizer."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#tokenizerconfigsource",children:(0,r.jsx)(n.code,{children:"tokenizerConfigSource"})})," - The location of the used tokenizer config."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#ondownloadprogresscallback",children:(0,r.jsx)(n.code,{children:"onDownloadProgressCallback"})})," - Callback to track download progress."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This method returns a promise, which can resolve to an error or void."}),"\n",(0,r.jsxs)(n.p,{children:["For more information on loading resources, take a look at ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/fundamentals/loading-models",children:"loading models"})," page."]}),"\n",(0,r.jsx)(n.h2,{id:"listening-for-download-progress",children:"Listening for download progress"}),"\n",(0,r.jsxs)(n.p,{children:["To subscribe to the download progress event, you can pass the ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#ondownloadprogresscallback",children:(0,r.jsx)(n.code,{children:"onDownloadProgressCallback"})})," function to the ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#load",children:(0,r.jsx)(n.code,{children:"load"})})," method. This function is called whenever the download progress changes."]}),"\n",(0,r.jsx)(n.h2,{id:"running-the-model",children:"Running the model"}),"\n",(0,r.jsxs)(n.p,{children:["To run the model, you can use ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#generate",children:(0,r.jsx)(n.code,{children:"generate"})})," method. It allows you to pass chat messages and receive completion from the model. It doesn't provide any message history management."]}),"\n",(0,r.jsxs)(n.p,{children:["Alternatively in managed chat (see: ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/hooks/natural-language-processing/useLLM#functional-vs-managed",children:"Functional vs managed"}),"), you can use the ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#sendmessage",children:(0,r.jsx)(n.code,{children:"sendMessage"})})," method. It accepts the user message and returns a promise that resolves to the generated response. Additionally, it will call ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#messagehistorycallback",children:(0,r.jsx)(n.code,{children:"messageHistoryCallback"})})," with the updated message history containing both user message and model response."]}),"\n",(0,r.jsxs)(n.p,{children:["If you need raw model access without any wrappers, you can use ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#forward",children:(0,r.jsx)(n.code,{children:"forward"})}),". It provides direct access to the model, so the input string is passed straight into the model and returns the generated response. It may be useful to work with models that aren't finetuned for chat completions. If you're not sure what are implications of that (e.g. that you have to include special model tokens), you're better off with ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#sendmessage",children:(0,r.jsx)(n.code,{children:"sendMessage"})}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"listening-for-generated-tokens",children:"Listening for generated tokens"}),"\n",(0,r.jsxs)(n.p,{children:["To subscribe to the token generation event, you can pass ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#tokencallback",children:(0,r.jsx)(n.code,{children:"tokenCallback"})})," or ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#messagehistorycallback",children:(0,r.jsx)(n.code,{children:"messageHistoryCallback"})})," functions to the constructor. ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#tokencallback",children:(0,r.jsx)(n.code,{children:"tokenCallback"})})," is called on every token and contains only the most recent token. ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#messagehistorycallback",children:(0,r.jsx)(n.code,{children:"messageHistoryCallback"})})," is called whenever model finishes generation and contains all message history including user's and model's last messages."]}),"\n",(0,r.jsx)(n.h2,{id:"interrupting-the-model",children:"Interrupting the model"}),"\n",(0,r.jsxs)(n.p,{children:["In order to interrupt the model, you can use the ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#interrupt",children:(0,r.jsx)(n.code,{children:"interrupt"})})," method."]}),"\n",(0,r.jsx)(n.h2,{id:"token-batching",children:"Token Batching"}),"\n",(0,r.jsxs)(n.p,{children:["Depending on selected model and the user's device generation speed can be above 60 tokens per second. If the ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#tokencallback",children:(0,r.jsx)(n.code,{children:"tokenCallback"})})," triggers rerenders and is invoked on every single token it can significantly decrease the app's performance. To alleviate this and help improve performance we've implemented token batching. To configure this you need to call ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#configure",children:(0,r.jsx)(n.code,{children:"configure"})})," method and pass ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/LLMConfig#generationconfig",children:(0,r.jsx)(n.code,{children:"generationConfig"})}),". In the next section, there are listed what you can tweak with this config."]}),"\n",(0,r.jsx)(n.h2,{id:"configuring-the-model",children:"Configuring the model"}),"\n",(0,r.jsxs)(n.p,{children:["To configure model (i.e. change system prompt, load initial conversation history or manage tool calling, set generation settings) you can use\n",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#configure",children:(0,r.jsx)(n.code,{children:"configure"})})," method. ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/LLMConfig#chatconfig",children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"chatConfig"})})})," and ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/LLMConfig#toolsconfig",children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"toolsConfig"})})})," is only applied to managed chats i.e. when using ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#sendmessage",children:(0,r.jsx)(n.code,{children:"sendMessage"})})," (see: ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/hooks/natural-language-processing/useLLM#functional-vs-managed",children:"Functional vs managed"}),") It accepts object with following fields:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/LLMConfig#chatconfig",children:(0,r.jsx)(n.code,{children:"chatConfig"})})," - Object configuring chat management that contains:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/ChatConfig#systemprompt",children:(0,r.jsx)(n.code,{children:"systemPrompt"})}),' - Often used to tell the model what is its purpose, for example - "Be a helpful translator".']}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/ChatConfig#initialmessagehistory",children:(0,r.jsx)(n.code,{children:"initialMessageHistory"})})," - Object that represent the conversation history. This can be used to provide initial context to the model."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/ChatConfig#contextwindowlength",children:(0,r.jsx)(n.code,{children:"contextWindowLength"})})," - The number of messages from the current conversation that the model will use to generate a response. Keep in mind that using larger context windows will result in longer inference time and higher memory usage."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/ToolsConfig",children:(0,r.jsx)(n.code,{children:"toolsConfig"})})," - Object configuring options for enabling and managing tool use. ",(0,r.jsx)(n.strong,{children:"It will only have effect if your model's chat template support it"}),". Contains following properties:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/ToolsConfig#tools",children:(0,r.jsx)(n.code,{children:"tools"})})," - List of objects defining tools."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/ToolsConfig#executetoolcallback",children:(0,r.jsx)(n.code,{children:"executeToolCallback"})})," - Function that accepts ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/ToolCall",children:(0,r.jsx)(n.code,{children:"ToolCall"})}),", executes tool and returns the string to model."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/ToolsConfig#displaytoolcalls",children:(0,r.jsx)(n.code,{children:"displayToolCalls"})})," - If set to ",(0,r.jsx)(n.code,{children:"true"}),", JSON tool calls will be displayed in chat. If ",(0,r.jsx)(n.code,{children:"false"}),", only answers will be displayed."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/LLMConfig#generationconfig",children:(0,r.jsx)(n.code,{children:"generationConfig"})})," - Object configuring generation settings with following properties:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/GenerationConfig#batchtimeinterval",children:(0,r.jsx)(n.code,{children:"outputTokenBatchSize"})})," - Soft upper limit on the number of tokens in each token batch (in certain cases there can be more tokens in given batch, i.e. when the batch would end with special emoji join character)."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/GenerationConfig#batchtimeinterval",children:(0,r.jsx)(n.code,{children:"batchTimeInterval"})})," - Upper limit on the time interval between consecutive token batches."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/GenerationConfig#temperature",children:(0,r.jsx)(n.code,{children:"temperature"})})," - Scales output logits by the inverse of temperature. Controls the randomness / creativity of text generation."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/interfaces/GenerationConfig#topp",children:(0,r.jsx)(n.code,{children:"topp"})})," - Only samples from the smallest set of tokens whose cumulative probability exceeds topp."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"deleting-the-model-from-memory",children:"Deleting the model from memory"}),"\n",(0,r.jsxs)(n.p,{children:["To delete the model from memory, you can use the ",(0,r.jsx)(n.a,{href:"/react-native-executorch/docs/next/api-reference/classes/LLMModule#delete",children:(0,r.jsx)(n.code,{children:"delete"})})," method."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);